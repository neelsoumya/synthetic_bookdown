# Generating data using synthpop methods

In this chapter we will look at how to generate synthetic data on the server side using DataSHIELD functions

First we need to build a login object for the server that holds the data:

```{r log in object}
builder <- DSI::newDSLoginBuilder()
# hide credentials
builder$append(server="server1", url="https://opal-sandbox.mrc-epid.cam.ac.uk",
               user="dsuser", password="password", 
               table = "DASIM.DASIM1")
logindata <- builder$build()
```

And then we establish a connection to the server:

```{r log in}
library(DSOpal)
if(exists("connections")){
  datashield.logout(conns = connections)
}
connections <- datashield.login(logins=logindata, assign = TRUE)
```
The first option is to generate a synthetic dataset using an implementation of the **synthpop** package on the server side. Assuming we have a data set with a small number of columns (i.e. around 10) we can simply execute the following command:

```{r synthpop data gen}
library(dsSyntheticClient)
library(dsBaseClient)
synth_data = ds.syn(data = "D", method = "cart", m = 1, seed = 123)$server1$syn
```
We then have the synthetic data on the client side and can view and manipulate it as required:
```{r synthpop data check}
head(synth_data)
```
If you have a dataset with a larger number of columns, you could generate a synthetic dataset for a subset of the variables that you need to generate a particular harmonised variable. For example if we needed to generate a diabetes variable based on blood triglycerides, HDL and glucose we could just generate a dataset for those variables:
```{r synthpop data subset}
ds.subset(x = "D", subset = "D2", cols = c("LAB_HDL", "LAB_TRIG", "LAB_GLUC_FASTING"))
synth_data_sub = ds.syn(data = "D2", method = "cart", m = 1, seed = 123)$server1$syn
head(synth_data_sub)
```


